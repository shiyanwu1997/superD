# 权限控制和用户相关功能测试方案

## 1. 测试目的
- 验证普通管理员能够正常创建用户
- 验证程序详情页面的状态显示正确
- 验证项目权限继承逻辑符合预期
- 验证不同角色用户的权限控制正确
- 验证用户管理功能的完整性

## 2. 测试环境
- 前端：http://localhost:3000
- 后端：http://localhost:3000/api
- 数据库：MySQL

## 3. 测试用户和角色
| 用户名 | 角色 | 密码 | 角色ID | 备注 |
|--------|------|------|--------|------|
| admin | 超级管理员 | oplgmpnb91b9akbd | 1 | 全局唯一，不可删除 |
| qqq | 普通管理员 | 123456 | 2 | 用于测试普通管理员权限 |
| test | 普通用户 | 123456 | 3 | 用于测试普通用户权限 |

## 4. 测试用例

### 4.1 普通管理员创建用户功能
**测试点**：普通管理员能否看到用户管理菜单并创建用户

**测试步骤**：
1. 使用普通管理员账号`qqq`登录系统
2. 检查右上角菜单是否显示"用户管理"选项
3. 点击"用户管理"，进入用户管理页面
4. 点击"新增用户"按钮
5. 填写用户信息（用户名、密码），角色选择"普通用户"
6. 点击"OK"按钮，验证用户是否创建成功
7. 验证新创建的用户能否正常登录

**预期结果**：
- 普通管理员可以看到用户管理菜单
- 可以成功创建普通用户
- 新用户能够正常登录

### 4.2 程序详情页面状态显示
**测试点**：程序详情页面的状态显示是否正确

**测试步骤**：
1. 登录系统（任意角色）
2. 进入程序列表页面
3. 选择一个正在运行的程序，点击"详情/日志"按钮
4. 在程序详情页面中，检查"状态"字段是否显示正确（RUNNING/STOPPED等）
5. 对程序执行启动/停止操作，验证状态是否实时更新

**预期结果**：
- 程序状态显示正确（如RUNNING、STOPPED等）
- 执行操作后状态能够实时更新

### 4.3 项目权限继承测试
**测试点**：超级管理员给普通管理员创建的用户添加项目权限的处理逻辑

**测试步骤**：
1. 使用超级管理员`admin`登录
2. 创建一个新项目`TestProject`
3. 使用普通管理员`qqq`登录，创建一个普通用户`user1`
4. 使用超级管理员`admin`登录，为`user1`添加`TestProject`的权限
5. 使用普通用户`user1`登录，验证是否能看到并访问`TestProject`
6. 使用普通管理员`qqq`登录，验证是否能看到`user1`的权限变化

**预期结果**：
- 超级管理员可以为普通管理员创建的用户添加项目权限
- 用户能够成功获得并使用新增的项目权限
- 普通管理员可以看到用户的权限变化

### 4.4 用户管理权限控制
**测试点**：不同角色用户的权限控制

**测试步骤**：
1. 使用超级管理员`admin`登录
2. 创建普通管理员`admin2`和普通用户`user2`
3. 使用普通管理员`admin2`登录：
   - 尝试创建用户，验证只能创建普通用户
   - 尝试修改`admin`的权限，验证操作被拒绝
   - 尝试修改`qqq`创建的用户权限，验证操作被拒绝
4. 使用普通用户`user2`登录：
   - 验证没有用户管理菜单
   - 验证只能修改自己的密码

**预期结果**：
- 普通管理员只能创建普通用户
- 普通管理员只能操作自己或自己创建的用户
- 普通用户没有用户管理权限

### 4.5 角色转换功能测试
**测试点**：超级管理员能否进行角色转换

**测试步骤**：
1. 使用超级管理员`admin`登录
2. 创建普通用户`user3`
3. 将`user3`的角色转换为普通管理员
4. 验证`user3`作为管理员能够正常登录并使用管理员功能
5. 将`user3`的角色转换回普通用户
6. 验证`user3`的权限被限制

**预期结果**：
- 超级管理员可以将普通用户转换为管理员
- 超级管理员可以将管理员转换为普通用户
- 角色转换后权限立即生效

## 5. 边界测试

### 5.1 无效输入测试
**测试点**：验证系统对无效输入的处理

**测试步骤**：
1. 创建用户时使用空用户名或密码
2. 创建用户时使用已存在的用户名
3. 项目权限操作时使用无效的用户ID或项目ID

**预期结果**：
- 系统能够正确处理无效输入并给出提示
- 不会因为无效输入导致系统崩溃

### 5.2 权限边界测试
**测试点**：验证权限控制的边界情况

**测试步骤**：
1. 普通管理员尝试访问没有权限的项目
2. 普通用户尝试执行管理员操作
3. 普通管理员尝试修改admin用户的权限

**预期结果**：
- 系统能够正确拦截越权操作
- 给出明确的权限不足提示

## 6. 测试结果记录

| 测试用例ID | 测试点 | 测试结果 | 备注 |
|------------|--------|----------|------|
| 4.1 | 普通管理员创建用户功能 | | |
| 4.2 | 程序详情页面状态显示 | | |
| 4.3 | 项目权限继承测试 | | |
| 4.4 | 用户管理权限控制 | | |
| 4.5 | 角色转换功能测试 | | |
| 5.1 | 无效输入测试 | | |
| 5.2 | 权限边界测试 | | |

## 7. 验收标准
- 所有测试用例通过
- 普通管理员能够正常创建用户
- 程序状态显示正确
- 权限控制符合预期
- 没有严重的功能缺陷

## 8. 测试工具
- 浏览器：Chrome/Firefox
- 调试工具：DevTools
- API测试：Postman

## 9. 测试时间安排
- 测试准备：1小时
- 功能测试：4小时
- 边界测试：2小时
- 问题修复：2小时
- 回归测试：2小时
- 总计：11小时